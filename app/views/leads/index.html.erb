<div class='row'>
  <div class='col-lg-12'>
    <div class="row wrapper border-bottom white-bg page-heading text-center">
      <div class="col-lg-12">
        <div class="col-md-4 col-sm-4 col-xs-12">
          <div class="new-lead">
            <%= link_to 'New Lead', new_lead_url, class: "btn btn-primary pull-left", id: "new" %>
          </div>
        </div>
        <div class="col-md-4 col-sm-4 col-xs-12">
          <h2>Leads</h2>
          <ol class="breadcrumb">
            <li>
              <a href="/dashboard">Home</a>
            </li>
            <li>
              <a href="/dashboard">Sales</a>
            </li>
            <li class="active">
              <strong>Leads</strong>
            </li>
          </ol>
        </div>
        <!-- <div class="col-md-4 col-sm-4 col-xs-12">
          <form class="group-input">
            <input type='search' id='search-customer' placeholder="Search..." />
            <a class="submit" type="submit" href="#">
              <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
            </a>
          </form>
        </div> -->
      </div>
      <div class="col-md-4 col-sm-4 col-xs-12">
        <h2>Leads</h2>
        <ol class="breadcrumb">
          <li>
            <a href="/dashboard">Home</a>
          </li>
          <li>
            <a href="/dashboard">Sales</a>
          </li>
          <li class="active">
            <strong>Leads</strong>
          </li>
        </ol>
      </div>
      <!-- <div class="col-md-4 col-sm-4 col-xs-12">
        <form class="group-input">
          <input type='search' id='search-customer' placeholder="Search..." />
          <a class="submit" type="submit" href="#">
            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
          </a>
        </form>
      </div> -->
    </div>
  </div>
</div>
    
<div class='wrapper wrapper-content'>
  <div class='ibox'>
    <div class='ibox-content container-fluid white-bg'>
      <div id="vendor_filter">
        <% @leading_new = Lead.new %>
        <%= semantic_form_for @leading_new,  :url => "", :html => {:method => :get }  do |f| %>
          <%= f.inputs do %>
            <%= f.input :status, :as => :select, collection: Lead.all.collect(&:status).uniq %>
            <%= f.input :user_id, :as => :select, collection: User.all %>

            <%= f.input :travel_from, :as => :string, :input_html => { :class => 'input-icon-select-date'}, wrapper_html:{class: "text-center"}, placeholder: "Travel from"%>
            <%= f.input :travel_to, :label => "Travel To", :as => :string, :input_html => { :class => 'input-icon-select-date'}, wrapper_html:{class: "text-center"},placeholder: "Travel to" %>
          <% end %>
           <%= f.action :submit, :label => "Filter", :button_html => { :class => "btn btn-primary filter-lead" } %>
        <% end %>
      </div>
    </div>
    <div id="listing-table">
       <%= smart_listing_render(:leads) %>
    </div>
  </div>
</div>

   

<script language="javascript">
  $(document).ready(function() {
    var leadStatusValue, leadUserId;
    $('#lead_travel_from,#lead_travel_to').val("");
    $('.label').hide();
    $('#lead_travel_from').datetimepicker({
      timepicker: false,
      format:'d-m-Y',
      onChangeDateTime: function (db, $input) {
        $('#lead_travel_to').datetimepicker({
          timepicker: false,
          format:'d-m-Y',
           minDate: db,
        });
      }     
    });     
    
    $('#lead_travel_to').datetimepicker({
      timepicker: false,
      format:'d-m-Y',
      onChangeDateTime: function (db, $input) {
        $('#lead_travel_from').datetimepicker({
          timepicker: false,
          format:'d-m-Y',
          maxDate: db,
        });
      }
   
    }); 
  
    var leadStatus = $("select#lead_status");
    leadStatus.append('<option value="0">Booking Status</option>');
    leadStatus.val(0);
    leadStatus.selectbox({
      onChange: function (val, inst) {
        leadStatusValue = val;
      }
    });
    
    
    var leadSale = $("select#lead_user_id");
    leadSale.append('<option value="0">Sale Person</option>');
    leadSale.val(0);
    leadSale.selectbox({
      onChange: function (val, inst) {
        leadUserId = val;
      }
    });
        
    $(document.body).delegate("input.filter-lead", "click", function(e){
      e.preventDefault();     
      var url = "/leads";
      var travel_from = $("#lead_travel_from").val();
      var travel_to = $("#lead_travel_to").val();
      
      $.ajax({
        url: url,
        type: "GET",
        data:{
          ajax_call: true,
          lead_status: leadStatusValue,
          user_id: leadUserId,
          travel_from: travel_from,
          travel_to: travel_to
        },
        success: function(data) {
          $('div#listing-table').html(data);
        },
        error: function() {
        }
      });
      return false;
    });
    
  });  
</script>
